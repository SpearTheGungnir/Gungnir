<!DOCTYPE html>
<html>
	<head>
		<title><%= title %></title>
		<link rel='stylesheet' href='/stylesheets/style.css'/>
		<script>
			function deleteajax(id) {
				if (!confirm('您确定要删除吗？'))
					return;
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function() {
					if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {
						var json = eval('(' + xmlhttp.responseText + ')');
						if (json.res) {
							alert('删除成功！');
							window.location.reload(true);
						} else if (json.info === 'self') {
							alert('请不要删除自己');
						} else {
							alert('删除失败，请联系产品经理');
						}
					}
				}
				xmlhttp.open('GET', '/restaurants/delete?rid=' + id);
				//xmlhttp.send();
			}
			function search() {
				var user = document.getElementById('user').value;
				var food = document.getElementById('food').value;
				var str = '?';
				if (user.length > 0)
					str += 'uname=' + encodeURIComponent(user);
				if (food.length > 0) {
					if (user.lenght > 0) str += '&';
					str += 'fname=' + encodeURIComponent(food);
				}
				window.location.href = '/manager/homepage/sudo/comments/list0' + str;
			}
		</script>
	</head>
	<body>
		<h1><%= title %></h1>
		<h2><a href='/manager/homepage'>返回</a></h2>
		<p>Filter: <form>用户：<input id='user' type='text' value='<%= search.uname %>'></input>食物：<input id='food' type='text' value='<%= search.fname %>'></input>
			<input type='submit' value='Go' onclick='search();return false'></input></form></p>
		<table>
			<tr>
				<th>id</th><th>userid</th><th>userName</th><th>foodid</th><th>foodName</th><th>score</th><th>comment</th><th>time</th><th>operation</th>
			</tr>
			<% for(var i = 0; i < list.length; ++i) { %>
				<tr>
					<td><%= list[i].id %></td>
					<td><%= list[i].uid %></td>
					<td><%= list[i].uname %></td>
					<td><%= list[i].fid %></td>
					<td><%= list[i].fname %></td>
					<td><%= list[i].score %></td>
          <td><%= list[i].comment %></td>
					<td><%= list[i].time %></td>
					<td><button type='button' onclick='deleteajax(<%= list[i].id %>)'>删除</button></td>
				</tr>
			<% } %>
		</table>
		<% if (page > 0) { %>
			<p><a href='/manager/homepage/sudo/comments/list<%= page - 1 %>?uname=<%= encodeURIComponent(search.uname) %>&fname=<%= encodeURIComponent(search.fname) %>'>上一页</a></p>
		<% } %>
		<% if (list.length > 0) { %>
			<p><a href='/manager/homepage/sudo/comments/list<%= page + 1 %>?uname=<%= encodeURIComponent(search.uname) %>&fname=<%= encodeURIComponent(search.fname) %>'>下一页</a></p>
		<% } %>
	</body>
</html>
